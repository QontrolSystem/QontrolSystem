@model QontrolSystem.Models.ViewModels.AssignTicket

@{
    <link href="~/css/manager-dashboard/assignticketpopup.css" rel="stylesheet" />
}

<div id="assignTicketModalWrapper" class="custom-modal-backdrop">
    <div class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="assignTicketModalLabel">
        <div class="custom-modal-header">
            <h2 id="assignTicketModalLabel">Assign Ticket #@Model.TicketID</h2>
            <button class="custom-close-btn" onclick="closeAssignTicketModal()">✕</button>
        </div>

        <form asp-action="AssignTicket" method="post" id="assignTicketForm">
            @Html.AntiForgeryToken()
            <input type="hidden" name="TicketID" value="@Model.TicketID" />

            <div class="search-date">
                <label for="assignmentDate">Assignment Date:</label>
                <input type="date" id="assignmentDate" name="AssignmentDate"
                       value="@(Model.AssignmentDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.ToString("yyyy-MM-dd"))" required />

                <input type="text" id="searchBox" placeholder="Search by name or email" value="@Model.SearchTerm" class="form-control" autocomplete="off" />
                <button type="button" id="searchBtn">Search</button>
                <button type="button" id="clearBtn">Clear</button>
            </div>

            <div style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Email</th>
                            <th>Team</th>
                            <th>Active</th>
                            <th>Assign</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.TeamUsers)
                        {
                            var isCurrent = user.UserID == Model.CurrentAssigneeId;
                            <tr class="@(isCurrent ? "highlight-current" : "")">
                                <td>@user.FullName</td>
                                <td>@user.Email</td>
                                <td>@user.Team</td>
                                <td>
                                    @if (user.IsActive)
                                    {
                                        <span style="color:green;">Yes</span>
                                    }
                                    else
                                    {
                                        <span style="color:gray;">No</span>
                                    }
                                </td>
                                <td>
                                    <button type="submit" name="UserID" value="@user.UserID">
                                        Assign
                                    </button>
                                    @if (isCurrent)
                                    {
                                        <span style="margin-left:6px; font-size:0.9em; color:#555;">(Current)</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>

<script>
    // Optional: intercept form submit to disable assign buttons to avoid double-submit
    document.getElementById('assignTicketForm')?.addEventListener('submit', function (e) {
        // simple disable of submit buttons
        const buttons = this.querySelectorAll('button[type="submit"]');
        buttons.forEach(b => b.disabled = true);
    });

     

</script>
