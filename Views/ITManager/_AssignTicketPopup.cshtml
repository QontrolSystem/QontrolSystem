@model QontrolSystem.Models.ViewModels.AssignTicket

@{
    <link href="~/css/manager-dashboard/assignticketpopup.css" rel="stylesheet" />
}
<style>
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-box {
        background: #fff;
        padding: 20px 30px;
        border-radius: 8px;
        text-align: center;
        max-width: 400px;
        width: 100%;
    }

    .modal-buttons {
        margin-top: 20px;
    }

        .modal-buttons button {
            padding: 8px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

    #confirmYesBtn {
        background-color: #28a745;
        color: white;
    }

    #confirmNoBtn {
        background-color: #dc3545;
        color: white;
    }
</style>


<div id="assignTicketModalWrapper" class="custom-modal-backdrop">
    <div class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="assignTicketModalLabel">
        <div class="custom-modal-header">
            <h2 id="assignTicketModalLabel">Assign Ticket #@Model.TicketID</h2>
            <button class="custom-close-btn" onclick="closeAssignTicketModal()">✕</button>
        </div>

        <form asp-action="AssignTicket" method="post" id="assignTicketForm">
            @Html.AntiForgeryToken()
            <input type="hidden" name="TicketID" value="@Model.TicketID" />
            <input type="hidden" name="UserID" id="selectedUserID" />

            <div class="search-date">
                <label for="assignmentDate">Assignment Date:</label>
                <input type="date" id="assignmentDate" name="AssignmentDate"
                       value="@(Model.AssignmentDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.ToString("yyyy-MM-dd"))" required />

                <input type="text" id="searchBox" placeholder="Search by name or email" value="@Model.SearchTerm" class="form-control" autocomplete="off" />
                <button type="button" id="searchBtn">Search</button>
                <button type="button" id="clearBtn">Clear</button>
            </div>

            <div style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Email</th>
                            <th>Team</th>
                            <th>Active</th>
                            <th>Assign</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.TeamUsers)
                        {
                            var isCurrent = user.UserID == Model.CurrentAssigneeId;
                            <tr class="@(isCurrent ? "highlight-current" : "")">
                                <td>@user.FullName</td>
                                <td>@user.Email</td>
                                <td>@user.Team</td>
                                <td>
                                    @if (user.IsActive)
                                    {
                                        <span style="color:green;">Yes</span>
                                    }
                                    else
                                    {
                                        <span style="color:gray;">No</span>
                                    }
                                </td>
                                <td>
                                    <input type="hidden" name="TicketID" value="@Model.TicketID" />
                                    <button type="submit"
                                            class="assign-confirm-btn"
                                            name="UserID"
                                            value="@user.UserID"
                                            data-username="@user.FullName">
                                        Assign
                                    </button>

                                    @if (isCurrent)
                                    {
                                        <span style="margin-left:6px; font-size:0.9em; color:#555;">(Current)</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>
<!-- Custom Confirmation Modal -->
<div id="confirmationModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
        <p id="confirmationMessage">Are you sure?</p>
        <div class="modal-buttons">
            <button id="confirmYesBtn">OK</button>
            <button id="confirmNoBtn">Cancel</button>
        </div>
    </div>
</div>



<script>
    // Optional: intercept form submit to disable assign buttons to avoid double-submit
    document.getElementById('assignTicketForm')?.addEventListener('submit', function (e) {
        // simple disable of submit buttons
        const buttons = this.querySelectorAll('button[type="submit"]');
        buttons.forEach(b => b.disabled = true);
    });

     

</script>
